## 01_build.patch by Y Giridhar Appaji Nag <giridhar@appaji.net>
##
## Remove bin/* and the generated lcs files in the clean target.
## echo the command used during compilation

@DPATCH@
diff -urNad splint-3.1.2.dfsg~/Makefile.in splint-3.1.2.dfsg/Makefile.in
--- splint-3.1.2.dfsg~/Makefile.in	2007-12-19 10:13:19.000000000 +0530
+++ splint-3.1.2.dfsg/Makefile.in	2007-12-19 10:13:28.000000000 +0530
@@ -114,7 +114,7 @@
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 mkinstalldirs = $(SHELL) $(top_srcdir)/config/mkinstalldirs
 CONFIG_HEADER = config.h
-CONFIG_CLEAN_FILES =
+CONFIG_CLEAN_FILES = bin/Makefile
 DIST_SOURCES =
 
 RECURSIVE_TARGETS = info-recursive dvi-recursive install-info-recursive \
diff -urNad splint-3.1.2.dfsg~/src/Makefile.in splint-3.1.2.dfsg/src/Makefile.in
--- splint-3.1.2.dfsg~/src/Makefile.in	2007-12-19 10:13:19.000000000 +0530
+++ splint-3.1.2.dfsg/src/Makefile.in	2007-12-19 10:15:06.000000000 +0530
@@ -377,7 +377,7 @@
 
 binDir = bin
 
-CLEANFILES = splint$(EXEEXT)  ../$(top_builddir)/$(binDir)/splint$(EXEEXT)
+CLEANFILES = splint$(EXEEXT)  ../$(top_builddir)/$(binDir)/splint$(EXEEXT) Headers/flag_codes.gen
 subdir = src
 mkinstalldirs = $(SHELL) $(top_srcdir)/config/mkinstalldirs
 CONFIG_HEADER = $(top_builddir)/config.h
@@ -1148,7 +1148,7 @@
 splinttest: 
 	./splint $(DEFAULT_INCLUDES) $(DEFS) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) +singleinclude test.c +forcehints -misplacedsharequal +showsourceloc -unrecogcomments -fcnuse -incondefs -exportlocal -constuse -mts file -mts filerw +keep +supcounts +partial -null
 
-all: splint$(EXEEXT) ../$(top_builddir)/$(binDir)/splint$(EXEEXT)
+all: splint$(EXEEXT)
 
 ../$(top_builddir)/$(binDir)/splint$(EXEEXT):  splint$(EXEEXT)
 	-$(RM) -f $(top_builddir)/$(binDir)/splint$(EXEEXT)
@@ -1159,8 +1159,8 @@
 	$(MAKE) clean
 
 .c.o:
-	@echo "Compiling "$<"..."; \
-	source='$<' object='$@' libtool=no \
+	@echo "$(CCDEPMODE) $(depcomp) $(COMPILE) -c `test -f $< || echo '$(srcdir)/'`$<"
+	@source='$<' object='$@' libtool=no \
 	depfile='$(DEPDIR)/$*.Po' tmpdepfile='$(DEPDIR)/$*.TPo' \
 	$(CCDEPMODE) $(depcomp) \
 	$(COMPILE) -c `test -f $< || echo '$(srcdir)/'`$<
diff -urNad splint-3.1.2.dfsg~/test/Makefile.in splint-3.1.2.dfsg/test/Makefile.in
--- splint-3.1.2.dfsg~/test/Makefile.in	2007-12-19 10:13:19.000000000 +0530
+++ splint-3.1.2.dfsg/test/Makefile.in	2007-12-19 10:13:28.000000000 +0530
@@ -158,7 +158,8 @@
 
 QUICKTESTS = db3
 
-CLEANOUTPUT = $(GREP) -v "Splint 3." | $(GREP) -v "$(SPLINT)" | $(GREP) -v "^make.*\[[1-9]*\]:" | $(GREP) -v "^gmake.*\[[1-9]*\]:" |   $(GREP) -v "^gmake -e" |  $(GREP) -v "^make -e" |$(GREP) -v "config.status: creating test/Makefile" | $(GREP) -v "cd .. && " | $(GREP) -v "CONFIG_HEADERS=" | $(GREP) -v "CONFIG_FILES="
+CLEANOUTPUT = $(GREP) -v "Splint 3." | $(GREP) -v "$(SPLINT)" | $(GREP) -v "^make.*\[[1-9]*\]:" | $(GREP) -v "^gmake.*\[[1-9]*\]:" |   $(GREP) -v "^gmake -e" |  $(GREP) -v "^make -e" |$(GREP) -v "config.status: creating test/Makefile" | $(GREP) -v "cd .. && " | $(GREP) -v "CONFIG_HEADERS=" | $(GREP) -v "CONFIG_FILES=" | \
+$(GREP) -v "^/usr/bin/make.*\[[1-9]*\]:" | $(GREP) -v "^/usr/bin/gmake.*\[[1-9]*\]:" |   $(GREP) -v "^/usr/bin/gmake -e" |  $(GREP) -v "^/usr/bin/make -e"
 
 
 #drl 12/07/2002 These rules for .c and .expect files don't make sense
@@ -945,9 +946,12 @@
 
 .PHONY: clean-local
 clean-local:
-	-rm -f *~ #*# *.o *.lcs a.out
+	-rm -f *~ \#*\# *.o *.lcs a.out
 	-rm -f *.out
 	-rm  *.lcd *.lh
+	-cd tests2.2; $(MAKE) clean
+	-cd tests2.4; $(MAKE) clean
+	-cd tests2.5; $(MAKE) clean
 	-cd db1; $(MAKE) clean
 	-cd db2; $(MAKE) clean
 	-cd db3; $(MAKE) clean
diff -urNad splint-3.1.2.dfsg~/test/tests2.2/Makefile splint-3.1.2.dfsg/test/tests2.2/Makefile
--- splint-3.1.2.dfsg~/test/tests2.2/Makefile	2007-12-19 10:13:19.000000000 +0530
+++ splint-3.1.2.dfsg/test/tests2.2/Makefile	2007-12-19 10:13:28.000000000 +0530
@@ -48,3 +48,6 @@
 
 struct:
 	-$(SPLINT) struct.c -expect 1
+
+clean:
+	rm -f bool.lcs
diff -urNad splint-3.1.2.dfsg~/test/tests2.4/Makefile splint-3.1.2.dfsg/test/tests2.4/Makefile
--- splint-3.1.2.dfsg~/test/tests2.4/Makefile	2007-12-19 10:13:19.000000000 +0530
+++ splint-3.1.2.dfsg/test/tests2.4/Makefile	2007-12-19 10:13:28.000000000 +0530
@@ -78,11 +78,5 @@
 source:
 	$(SPLINT) -D DBL_MANT_DIG=25 source.c -expect 1
 
-
-
-
-
-
-
-
-
+clean:
+	rm -f subdir/main.lcs
diff -urNad splint-3.1.2.dfsg~/test/tests2.5/Makefile splint-3.1.2.dfsg/test/tests2.5/Makefile
--- splint-3.1.2.dfsg~/test/tests2.5/Makefile	2007-12-19 10:13:19.000000000 +0530
+++ splint-3.1.2.dfsg/test/tests2.5/Makefile	2007-12-19 10:13:28.000000000 +0530
@@ -44,3 +44,6 @@
 
 impabsmodule:
 	-${SPLINT} +impabstract impabsmodule.c -expect 2
+
+clean:
+	rm -f newlint.lcd
