Description: Make the build reproducible
Author: Chris Lamb <lamby@debian.org>
Bug-Debian: https://bugs.debian.org/797254

--- a/configure
+++ b/configure
@@ -3948,9 +3948,15 @@ _ACEOF
 # These used to be in herald.h
 LCL_PARSE_VERSION="Splint 3.1.2"
 
+if [ -n "${SOURCE_DATE_EPOCH}" ]; then
+cat >>confdefs.h <<_ACEOF
+#define SPLINT_VERSION "$LCL_PARSE_VERSION --- `LC_ALL=C date --utc --date="@${SOURCE_DATE_EPOCH}" +"%d %b %Y"`"
+_ACEOF
+else
 cat >>confdefs.h <<_ACEOF
 #define SPLINT_VERSION "$LCL_PARSE_VERSION --- `date +"%d %b %Y"`"
 _ACEOF
+fi
 
 
 cat >>confdefs.h <<_ACEOF
--- a/configure.ac
+++ b/configure.ac
@@ -157,9 +157,15 @@ AC_DEFINE_UNQUOTED(DEFAULT_LCLIMPORTDIR,
 
 # These used to be in herald.h
 LCL_PARSE_VERSION="AC_PACKAGE_NAME AC_PACKAGE_VERSION"
+if [ -n "${SOURCE_DATE_EPOCH}" ]; then
+AC_DEFINE_UNQUOTED(SPLINT_VERSION,
+                   "$LCL_PARSE_VERSION --- `LC_ALL=C date --utc --date="@${SOURCE_DATE_EPOCH}" +"%d %b %Y"`",
+                   [Splint's version number and configure/build date])
+else
 AC_DEFINE_UNQUOTED(SPLINT_VERSION,
                    "$LCL_PARSE_VERSION --- `date +"%d %b %Y"`",
                    [Splint's version number and configure/build date])
+fi
 AC_DEFINE_UNQUOTED(LCL_PARSE_VERSION, "$LCL_PARSE_VERSION",
                    [Splint's version number])
 AC_DEFINE_UNQUOTED(LCL_COMPILE,
